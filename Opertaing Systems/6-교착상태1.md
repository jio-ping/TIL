## 교착상태

: 여러 개의 프로세스가 서로 상대방의 작업이 끝나기만 기다리고 있어 어느쪽도 영원히 진행하지 못하는 상태

<details>
<summary> 교착상태 vs 기아상태</summary>
- 교착상태 : 영원히 해결 X
<img src="https://github.com/user-attachments/assets/a2a292d5-af10-46e4-9243-dd055517df14" alt="교착상태" width="300px"></br>
- 기아상태: 기다리다보면 . . 해결이 될 수도
<img width="300px" alt="기아상태" src="https://github.com/user-attachments/assets/9d5fbe7b-b681-4547-974b-44c7a189d515" />
</details>

### 📌 교착상태의 필요조건

: 상호배제, 점유대기, 비선점, 환형대기 이 네 가지 조건이 동시에 만족될 때 교착상태 발생 가능

#### 📎 상호배제(mutual exclusive)

: 프로세스가 자원에 대한 배타적인 통제권을 요구하며 적어도 하나 이상의 자원은 여러 프로세스에 의해 동시에 사용될 수 없음</br>
➡️ 다른 프로세스가 점유한 자원이 필요하면 반드시 대기 </br>

- 예시: 출력물을 인쇄하는 프린터는 출력이 완료 될 때까지 기다려야됨

#### 📎 점유대기(hold and wait)

: 프로세스가 이미 한 자원을 할당받아 점유하고 있는 상황에서 다른 프로세스가 점유하고 있는 또 다른 자원을 요구하여 해제되기를 기다리는 상황

- 예시: 프로세스 A는 문서를 스캔해(스캐너 점유) PDF로 저장한 뒤, 프린터로 출력하고자(프린터 대기) 하며 프로세스 B는 문서를 인쇄 중(프린터 점유)에 원본 문서를 스캔해 저장하는 경우(스캐너 대기)

#### 📎 비선점(no preemption)

: 프로세스에 할당된 자원은 그 프로세스가 사용을 마치고 스스로 반환하기 전에는 해제되지 않음</br>
➡️ 할당된 자원은 타의에 의해서는 해제되지 않음

- 예시: 프로세스 A가 프린터를 점유 중엔 프로세스 B가 아무리 급해도 뺏을수 없음

#### 📎 환형대기조건(circular wait)

: 프로세스의 자원 점유 및 점유된 자원의 요구관계가 환형을 이루며 대기하는 상황</br>

- 예시:
  - 프로세스 A : 프린터 점유, 스캐너 요청
  - 프로세스 B : 스캐너 점유, 모니터 요청
  - 프로세스 C : 모니터 점유, 프린터 요청

### 📌 자원할당 그래프 G = (V,E)

<img src="https://github.com/user-attachments/assets/12d3b8cc-69c2-4447-929e-b5a4237775ad" width="400px"></br>

- V : 정점의 집합 V = P ∪ R </br>

  - P = {p<sub>1</sub>,p<sub>3</sub>,p<sub>3</sub>, ... ,p<sub>n</sub>} : n 개의 프로세스
  - R = {r<sub>1</sub>,r<sub>3</sub>,r<sub>3</sub>, ... ,r<sub>n</sub>} : n 개의 자원

- E : 방향 있는 간선의 집합 E = Q ∪ S </br>
  - Q : {( p<sub>i</sub>, r<sub>j</sub> ):p<sub>i</sub> ∈ R , r<sub>j</sub> ∈ R} : 프로세스 p<sub>i</sub> 가 자원 r<sub>j</sub>를 요구 </br>

➡️ 사이클이 있어야 교착상태 발생 가능성이 있음

### 📌 교착상태의 처리기법

1. 교착상태 예방 : 교착상태의 네가지 필요조건이 동시에 만족되는 것을 피해 교착상태가 발생하지 않도록 하는 방법
2. 교착상태 회피 : 프로세스에 필요한 자원의 최대량에 대한 정보를 이용해 교착상태가 발생하지 않도록 하는 방법
3. 교착 상태 탐지 및 복구 : 교착상태의 발생 여부를 조사하여 발생한 경우에는 적절한 조치를 취해 정상사태로 복구하는 방법

### 📌 교착상태 예방

#### 📎 상호배제 조건 제거

- 공유할 수 있는 자원 : 상호배제 필요 없음 </br>
  - 예: 읽기 전용 파일 </br>
- 공유할 수 없는 자원 : 반드시 상호배제 필요 </br>
  - 예: 프린터 </br>
    ➡️ 상호배제 조건 제거로 교착상태 예방은 불가능

#### 📎 점유대기 조건 제거

1. 자원을 점유했을 때 대기하지 않아야함</br>
   : 필요한 모든 자원을 한 번에 요구 (자원을 하나라도 못 받을거면 애초에 점유❌)</br>
   ➡️ 자원이용률 낮아짐, 기아상태 가능
2. 대기할 때 자원을 점유하고 있지 않아야 함</br>
   : 새로운 자원을 요구할 때 할당받았던 자원을 모두 해제(자원 더 요청할 거면 지금 점유한 자원부터 반납하고 기다림)</br>
   🚫 점유 도중 해제할 수 없는 자원에는 적용 불가

#### 📎 비선점 조건 제거

1. 선점이 가능하도록 해야 함</br>
   : 자원의 특성에 따라 불가능한 경우도 존재</br>
   - 예시: 프린터 인쇄 중에 출력 멈출 수 없음, 파일에 내용 쓰는 중에 중단하면 데이터 일관성 깨짐</br>
2. 다른 프로세스가 대기할 가능성 줄이기 </br>
   : 점유대기 상황이 발생하면 할당받았던 자원을 모두 해제
   - 예시: 프린터 점유 중에 스캐너가 필요한데 점유하지 못했다면 프린터도 놔버림 </br>

#### 📎 환형대기 조건 제거

- 모든 자원에 일련번호를 지정</br>
  ex. 일련번호: 프린터(1) 스캐너(2) CD-ROM(3)</br>

  - 방법 1. 프로세스는 자원을 요구할 때 일련번호 기준으로 항상 오름차순이 되도록 요구</br>
    - 프로세스 A : 프린터(1) -> 스캐너(2) 요청
    - 프로세스 B : 스캐너(2) -> CD-ROM(3) 요청
  - 방법 2. 프로세스가 자원을 이미한 점유 한 경우, 자원을 요구할 때 그보다 일련번호가 작원 자원만 점유하도록 함</br>
    - 프로세스 A: 프린터(1) 점유 -> CD-ROM, 스캐너 요청 불가
      ➡️ 점유대기 중인 프로세스는 점유 중인 자원의 일련번호보다 대기 중인 자원의 일련번호가 큼, 프로세스 마다 요구순서가 다를 수 있어 자원의 일련번호 설정이 어려움
